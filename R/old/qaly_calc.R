## Include nationallifetables3yruk.xlsx
## data from SF-6D normal Berg et al. 2012, https://onlinelibrary.wiley.com/doi/full/10.1002/hec.1823

SF_6D_norms <- c(rep(0.9, 16),
         rep(0.843, 5),
         rep(0.819, 5),
         rep(0.818, 5),
         rep(0.814, 5),
         rep(0.811, 5),
         rep(0.805, 5),
         rep(0.794, 5),
         rep(0.785, 5),
         rep(0.779, 5),
         rep(0.775, 5),
         rep(0.778, 5),
         rep(0.755, 5),
         rep(0.732, 5),
         rep(0.702, 5),
         rep(0.661, 15))

# .From life expectancy data from national life tables3yruk.xlsx
life_exp_male <- c(79.04, 78.37, 77.39, 76.40, 75.41, 74.42, 73.42, 72.43, 71.43,
    70.44, 69.44, 68.45, 67.45, 66.46, 65.47, 64.48, 63.49, 62.50, 61.52, 60.54,
    59.57, 58.60, 57.63, 56.66, 55.69, 54.72, 53.75, 52.78, 51.82, 50.85, 49.89,
    48.93, 47.97, 47.01, 46.05, 45.10, 44.15, 43.20, 42.26, 41.31, 40.37, 39.43,
    38.50, 37.57, 36.65, 35.73, 34.81, 33.90, 33.00, 32.09, 31.20, 30.31, 29.42,
    28.54, 27.66, 26.79, 25.93, 25.07, 24.22, 23.38, 22.55, 21.72, 20.91, 20.10,
    19.31, 18.53, 17.75, 17.00, 16.24, 15.50, 14.78, 14.06, 13.35, 12.65, 11.97,
    11.31, 10.67, 10.04, 9.44, 8.87, 8.31, 7.77, 7.26, 6.76, 6.28, 5.84, 5.41,
    5.02, 4.65, 4.32, 4.02, 3.70, 3.42, 3.16, 2.92, 2.70, 2.51, 2.34, 2.18, 2.02, 1.91)

life_exp_female <- c(82.86, 82.15, 81.17, 80.18, 79.18, 78.19, 77.19, 76.20, 75.20, 74.21,
    73.21, 72.22, 71.22, 70.22, 69.23, 68.24, 67.24, 66.25, 65.26, 64.28, 63.29, 62.30,
    61.32, 60.33, 59.34, 58.36, 57.37, 56.39, 55.40, 54.42, 53.44, 52.46, 51.48, 50.50,
    49.53, 48.56, 47.59, 46.62, 45.65, 44.69, 43.73, 42.77, 41.81, 40.86, 39.91, 38.96,
    38.02, 37.08, 36.14, 35.21, 34.28, 33.36, 32.44, 31.52, 30.61, 29.70, 28.79, 27.90,
    27.00, 26.12, 25.24, 24.37, 23.51, 22.66, 21.81, 20.97, 20.13, 19.31, 18.49, 17.68,
    16.88, 16.10, 15.31, 14.54, 13.79, 13.06, 12.34, 11.63, 10.95, 10.29, 9.66, 9.03,
    8.44, 7.86, 7.30, 6.78, 6.28, 5.81, 5.37, 4.96, 4.58, 4.22, 3.90, 3.60, 3.32, 3.06,
    2.83, 2.62, 2.43, 2.26, 2.09)

#Â Age distribution
age_dist <- c(1.0, 1.1, 1.1, 1.1, 1.1, 1.2, 1.1, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 
    1.1, 1.1, 1.1, 1.1, 1.2, 1.2, 1.2, 1.2, 1.2, 1.3, 1.3, 1.3, 1.3, 1.3, 1.4, 1.4, 1.4, 
    1.4, 1.4, 1.4, 1.4, 1.4, 1.3, 1.3, 1.3, 1.3, 1.3, 1.3, 1.2, 1.2, 1.2, 1.2, 1.3, 1.3, 
    1.4, 1.4, 1.4, 1.4, 1.4, 1.4, 1.4, 1.4, 1.4, 1.3, 1.3, 1.2, 1.2, 1.2, 1.1, 1.1, 1.0, 
    1.0, 1.0, 1.0, 0.9, 0.9, 1.0, 1.0, 1.1, 1.0, 0.8, 0.8, 0.7, 0.7, 0.6, 0.5, 0.6, 0.5, 
    0.5, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.2, 0.2, 0.1, 0.1, 0.1, 0.1, 0.0, 0.0, 0.0, 0.0, 0.0) / 100

# Create a table of lie expectancy 
df_life_table <- data.frame(
    age_group = 0:100,
    hr_qol = SF_6D_norms,
    life_exp_male = life_exp_male,
    life_exp_female = life_exp_female,
    age_dist = age_dist
) %>%  mutate(life_exp = round((life_exp_female + life_exp_male) / 2, 0))

write.csv(df_life_table, file = here::here("data-raw", "life_tables.csv"))

discount_qaly_loss_death <- vector()
for (i in 1:100) {
    vals <- df_life_table[i, ]
    discount_qaly_loss_death[i] <- (df_life_table$hr_qol[(i - 1) + 1:(vals$life_exp)] * exp(- (1:(vals$life_exp) - 1)* 0.035)) %>% sum
}

df_life_table$qaly_loss <- c(discount_qaly_loss_death, 0)  
write.csv(df_life_table, file = here::here("data-raw", "life_tables.csv"))


post_vector <- list(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 3, 4, 5, 6:10, 11:15, 16:25, 26:35, 36:45, 46:55, 56:65, 66:75, 76:100)
discount_qaly_loss_death_age <- vector()

for(i in 1:25) {
    pos <- post_vector[[i]]
    discount_qaly_loss_death_age[i] <- (discount_qaly_loss_death[pos] * df_life_table$age_dist[pos] / sum(df_life_table$age_dist[pos])) %>% sum
}



